<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>GW2 TP Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <nav>
    <div class="nav-links">
      <a href="/" class="nav-link">ğŸ“Š Dashboard</a>
      <a href="/plan" class="nav-link">ğŸ›’ Recommender</a>
      <a href="/deliveries" class="nav-link">ğŸ“¦ Deliveries</a>
      <a href="/favorites" class="nav-link">â­ Favorites</a>
      <a href="/settings" class="nav-link">âš™ï¸ Settings</a>
    </div>
    <div class="nav-search-wrapper">
      <input id="item-search" class="nav-search" placeholder="ğŸ” Filter itemsâ€¦">
    </div>
  </nav>

  <div class="content">
    <header class="overview-grid">
      <div><strong>Total BUY locked:</strong>
        {% if total_buy_copper >= 10000 %}{{ total_buy_copper//10000 }}ğŸ¥‡{% endif %}
        {% if total_buy_copper >= 100 %}{{ (total_buy_copper//100)%100 }}ğŸ¥ˆ{% endif %}
        {{ total_buy_copper%100 }}ğŸ¥‰
      </div>
      <div><strong>Total SELL locked:</strong>
        {% if total_sell_copper >= 10000 %}{{ total_sell_copper//10000 }}ğŸ¥‡{% endif %}
        {% if total_sell_copper >= 100 %}{{ (total_sell_copper//100)%100 }}ğŸ¥ˆ{% endif %}
        {{ total_sell_copper%100 }}ğŸ¥‰
      </div>
      <div><strong>Delivery Box:</strong>
        {% if total_delivery_copper >= 10000 %}{{ total_delivery_copper//10000 }}ğŸ¥‡{% endif %}
        {% if total_delivery_copper >= 100 %}{{ (total_delivery_copper//100)%100 }}ğŸ¥ˆ{% endif %}
        {{ total_delivery_copper%100 }}ğŸ¥‰
      </div>
      <div><strong>Grand Total:</strong>
        {% if grand_total_copper >= 10000 %}{{ grand_total_copper//10000 }}ğŸ¥‡{% endif %}
        {% if grand_total_copper >= 100 %}{{ (grand_total_copper//100)%100 }}ğŸ¥ˆ{% endif %}
        {{ grand_total_copper%100 }}ğŸ¥‰
      </div>
      <!-- Sparkline -->
      <canvas id="sparkline" width="140" height="40"></canvas>
    </header>

    <!-- Tables for buy/sell orders -->
    <div class="tables">
      <section class="panel">
        <h2>Buy Orders</h2>
        <table>
          <thead>
            <tr><th>Name</th><th>Qty</th><th>Price</th><th>Locked</th></tr>
          </thead>
          <tbody>
          {% for o in buys %}
            <tr>
              <td>{{o.name}}</td>
              <td>{{o.quantity}}</td>
              <td>
                {% if o.price>=10000 %}{{o.price//10000}}ğŸ¥‡{% endif %}
                {% if o.price>=100 %}{{(o.price//100)%100}}ğŸ¥ˆ{% endif %}
                {{o.price%100}}ğŸ¥‰
              </td>
              <td>
                {% set v=o.price*o.quantity %}
                {% if v>=10000 %}{{v//10000}}ğŸ¥‡{% endif %}
                {% if v>=100 %}{{(v//100)%100}}ğŸ¥ˆ{% endif %}
                {{v%100}}ğŸ¥‰
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </section>

      <section class="panel">
        <h2>Sell Orders</h2>
        <table>
          <thead>
            <tr><th>Name</th><th>Qty</th><th>Price</th><th>Locked</th></tr>
          </thead>
          <tbody>
          {% for o in sells %}
            <tr>
              <td>{{o.name}}</td>
              <td>{{o.quantity}}</td>
              <td>
                {% if o.price>=10000 %}{{o.price//10000}}ğŸ¥‡{% endif %}
                {% if o.price>=100 %}{{(o.price//100)%100}}ğŸ¥ˆ{% endif %}
                {{o.price%100}}ğŸ¥‰
              </td>
              <td>
                {% set v=o.price*o.quantity %}
                {% if v>=10000 %}{{v//10000}}ğŸ¥‡{% endif %}
                {% if v>=100 %}{{(v//100)%100}}ğŸ¥ˆ{% endif %}
                {{v%100}}ğŸ¥‰
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <!-- Filter script -->
  <script>
    document.getElementById('item-search')
      .addEventListener('input', e => {
        const f = e.target.value.toLowerCase();
        document.querySelectorAll('.panel tbody tr').forEach(r => {
          r.style.display = r.cells[0].textContent.toLowerCase().includes(f) ? '' : 'none';
        });
      });
  </script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('goldChart').getContext('2d');
  const data = {
    labels: {{ totals.keys()|list|tojson }},
    datasets: [{
      label: 'Gold Locked (g)',
      data: {{ totals.values()|list|tojson }},
      backgroundColor: ['rgba(241,196,15,0.8)','rgba(231,76,60,0.8)','rgba(46,204,113,0.8)','rgba(52,152,219,0.8)']
    }]
  };
  new Chart(ctx, { type: 'bar', data });
</script>
  
</body>
</html>
